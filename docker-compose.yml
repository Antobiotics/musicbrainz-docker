postgresqldata:
  build: data-dockerfile
  restart: always
  volumes:
   - /datadump:/media/dbdump:rw
  environment:
   - constaint:role==storage

postgresql:
  build: postgres-dockerfile
  restart: always
  env_file:
   - ./postgres-dockerfile/postgres.env
  volumes:
   - /mnt/pgdata/pgdata:/var/lib/postgresql/data
  expose:
   - "5432"
  environment:
   - constaint:role==storage

musicbrainz:
  build: musicbrainz-dockerfile
  ports:
   - "5000:5000"
  volumes_from:
   - postgresqldata
  restart: always
  environment: 
   - MUSICBRAINZ_USE_PROXY=1
  expose: 
   - "5000"
  links:
   - postgresql:db
   - search:search
  environment:
   - constaint:role==musicbrainz

indexer:
  build: indexer-dockerfile
  links:
   - postgresql:db
  volumes:
   - /mnt/data:/home/search/data
  environment:
   - constaint:role==storage

search:
  build: search-dockerfile
  expose:
   - "8080"
  volumes:
   - /mnt/data:/home/search/data
  environment:
   - constaint:role==storage
